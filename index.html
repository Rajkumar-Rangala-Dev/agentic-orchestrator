<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Agentic Orchestrator</title>
    <style>
        body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; }
        .container { flex: 1; display: flex; flex-direction: column; }
        textarea { height: 400px; font-family: monospace; }
        pre { background-color: #f4f4f4; border: 1px solid #ddd; padding: 10px; height: 400px; overflow-x: auto; }
        button { padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>1. Define Workflow (JSON)</h2>
        <textarea id="workflow-json"></textarea>
        <button onclick="saveWorkflow()">Save Workflow</button>
        <p>Saved as: <b id="workflow-id-display"></b></p>
    </div>
    <div class="container">
        <h2>2. Execute and Monitor</h2>
        <button onclick="runWorkflow()">Run Saved Workflow</button>
        <p>Current Run ID: <b id="run-id-display"></b></p>
        <h3>Live Status:</h3>
        <pre id="status-display">{}</pre>
    </div>

<script>
    let currentWorkflowId = null;
    let currentRunId = null;
    let statusInterval = null;

    async function saveWorkflow() {
        const workflowJson = JSON.parse(document.getElementById('workflow-json').value);
        const response = await fetch('/workflow', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(workflowJson)
        });
        const data = await response.json();
        currentWorkflowId = data.workflow_id;
        document.getElementById('workflow-id-display').innerText = currentWorkflowId;
    }

    async function runWorkflow() {
        if (!currentWorkflowId) { alert("Please save a workflow first."); return; }
        const response = await fetch(`/workflow/${currentWorkflowId}/run`, { method: 'POST' });
        const data = await response.json();
        currentRunId = data.run_id;
        document.getElementById('run-id-display').innerText = currentRunId;

        if (statusInterval) clearInterval(statusInterval);
        statusInterval = setInterval(fetchStatus, 1000); // Poll for status every second
    }

    async function fetchStatus() {
        if (!currentRunId) return;
        const response = await fetch(`/run/${currentRunId}/status`);
        const data = await response.json();
        document.getElementById('status-display').innerText = JSON.stringify(data, null, 2);

        if (data.status === 'COMPLETED' || data.status === 'FAILED') {
            clearInterval(statusInterval);
        }
    }
</script>
</body>
</html>